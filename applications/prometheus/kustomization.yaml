apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: prometheus

resources:
  - ./namespace.yaml
  - ./tailscale-prom-sidecar-sealedsecret.yaml
  - ./prometheus-rules-cm.yaml
  - ./prometheus-targets-cm.yaml
helmCharts:
  - name: kube-prometheus-stack
    repo: https://prometheus-community.github.io/helm-charts
    releaseName: prometheus
    # Version upgrade notes and container image versions at:
    # https://artifacthub.io/packages/helm/prometheus-community/kube-prometheus-stack
    # Version changelogs at:
    # https://github.com/prometheus-community/helm-charts/releases
    version: 74.0.0 # operator version 0.83.0 / prometheus version 3.4.1 / grafana version 12.0.1
    namespace: prometheus
    includeCRDs: true
    valuesInline:
      alertmanager:
        enabled: false
      grafana:
        enabled: false
      prometheus:
        prometheusSpec:
          podMonitorSelectorNilUsesHelmValues: false
          probeSelectorNilUsesHelmValues: false
          ruleSelectorNilUsesHelmValues: false
          serviceMonitorSelectorNilUsesHelmValues: false